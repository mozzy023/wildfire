<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Commhundred - Mazzi Vincenti</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Favicon & App Icons -->
  <link rel="icon" href="assets/icons/favicon.ico?v=1">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png?v=1">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png?v=1">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon.png?v=1">
  <link rel="manifest" href="assets/icons/site.webmanifest?v=1">

  <!-- Colore barra indirizzi su mobile -->
  <meta name="theme-color" content="#e30613">
  <meta name="msapplication-TileColor" content="#e30613">

  <style>
    .centered-full {
      min-height: calc(100vh - 160px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .vincenti-list {
      list-style: none;
      padding: 0;
      margin: 2rem auto;
      max-width: 900px;
      width: 100%;
    }

    .vincenti-item {
      background-color: #fff;
      margin-bottom: 1rem;
      padding: 1.5rem;
      border-left: 5px solid var(--rosso-wildfire);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .vincenti-item span {
      display: block;
    }

    .deck-name {
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--rosso-wildfire);
    }

    .deck-author, .deck-commander, .deck-date, .deck-players, .deck-season {
      font-size: 0.95rem;
      color: #333;
    }

    .deck-link {
      align-self: flex-start;
      margin-top: 0.5rem;
      font-weight: 500;
      color: var(--rosso-wildfire);
      text-decoration: none;
      border: 1px solid var(--rosso-wildfire);
      padding: 0.4rem 0.8rem;
      border-radius: 5px;
      transition: 0.2s;
    }

    .deck-link:hover {
      background-color: var(--rosso-wildfire);
      color: white;
    }

    /* üîΩ Stile per i filtri */
    .filter-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1.2rem;
      margin-bottom: 1.6rem;
    }

    .filter-container label {
      font-weight: 600;
      color: var(--rosso-wildfire);
    }

    .filter-container select {
      padding: 0.45rem 0.8rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fff;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      transition: border-color .2s;
    }

    .filter-container select:hover {
      border-color: var(--rosso-wildfire);
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <div class="container">
      <header>
        <div class="brand">
          <img src="logo.png" alt="WildFire Logo" class="logo-img" />
          <div class="logo-text">Commhundred</div>
        </div>
        <nav>
          <a href="index.html">Home</a>
          <a href="carte-limitate.html">Carte Limitate</a>
          <a href="classifica-giocatori.html">Classifica Giocatori</a>
          <a href="liste-vincenti.html" class="active">Liste Vincenti</a>
          <a href="eventi.html">Eventi</a>
        </nav>
        <script>
        document.addEventListener("DOMContentLoaded", function () {
          const header = document.querySelector("header");
          const nav = document.querySelector("nav");

          if (!header || !nav) return;

          // 1) Crea il pulsante ‚ò∞ se non esiste
          let menuToggle = document.querySelector(".menu-toggle");
          if (!menuToggle) {
            menuToggle = document.createElement("button");
            menuToggle.className = "menu-toggle";
            menuToggle.textContent = "‚ò∞";
            header.appendChild(menuToggle);
          }

          // 2) Toggle apertura/chiusura
          function openMenu()  { nav.classList.add("show"); }
          function closeMenu() { nav.classList.remove("show"); }
          function isOpen()    { return nav.classList.contains("show"); }

          menuToggle.addEventListener("click", (e) => {
            e.stopPropagation();               // non far arrivare il click al document
            isOpen() ? closeMenu() : openMenu();
          });

          // 3) Chiudi quando clicchi/tocchi fuori dal menu o dal bottone
          function outsideHandler(e) {
            const target = e.target;
            if (!isOpen()) return;
            // se il click NON √® dentro al nav e NON √® sul bottone, chiudi
            if (!nav.contains(target) && !menuToggle.contains(target)) {
              closeMenu();
            }
          }
          // supporto mobile: pointerdown prende tap immediatamente
          document.addEventListener("pointerdown", outsideHandler);
          document.addEventListener("click", outsideHandler);

          // 4) Chiudi quando scegli una voce del menu (navigazione)
          nav.querySelectorAll("a").forEach(a => {
            a.addEventListener("click", () => closeMenu());
          });

          // 5) Chiudi con ESC
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && isOpen()) closeMenu();
          });

          // 6) Logo/scritta -> Home
          const brand = document.querySelector(".brand");
          if (brand) {
            brand.style.cursor = "pointer";
            brand.addEventListener("click", () => { window.location.href = "index.html"; });
          }
        });
        </script>
      </header>

      <section class="centered-full">
        <h2>Mazzi Vincenti</h2>

        <!-- üîΩ Filtri dinamici -->
        <div class="filter-container">
          <label for="filter-y">Year:</label>
          <select id="filter-y">
            <option value="tutte">Tutte</option>
          </select>

          <label for="filter-s">Season:</label>
          <select id="filter-s">
            <option value="tutte">Tutte</option>
          </select>
        </div>

        <ul id="vincenti-list" class="vincenti-list">
          <li class="vincenti-item">Caricamento in corso...</li>
        </ul>
      </section>

      <footer>
        <div class="footer-wrapper">
          <div class="footer-columns">
            <div class="footer-column">
              <h4>Contatti</h4>
              <p>üìç Via della Fonte Meravigliosa, 64<br>00143 Roma RM</p>
              <p>üìû <a href="tel:0695061442">06 9506 1442</a></p>
            </div>
            <div class="footer-column">
              <h4>Orari di apertura</h4>
              <p>Luned√¨: 19:00-02:00</p>
              <p>Marted√¨: 11:00‚Äì13:00 / 15:30‚Äì01:30</p>
              <p>Mercoled√¨: 11:00‚Äì13:00 / 15:30‚Äì19:30</p>
              <p>Gioved√¨: 11:00‚Äì13:00 / 15:30‚Äì19:30</p>
              <p>Venerd√¨: 11:00‚Äì13:00 / 15:30‚Äì01:30</p>
              <p>Sabato: 11:00‚Äì13:00 / 15:30‚Äì19:30</p>
              <p>Domenica: 11:00‚Äì19:30</p>
            </div>
            <div class="footer-column">
              <h4>Seguici</h4>
              <p>
                <a href="https://www.instagram.com/wildfire_store/" target="_blank">Instagram</a><br>
                <a href="https://www.facebook.com/Wildfirestore" target="_blank">Facebook</a><br>
                <a href="https://chat.whatsapp.com/CcXMy6eZsAD4rvFhGBsZU3" target="_blank">Community Whatsapp</a><br>
                <a href="https://www.cardmarket.com/it/Magic/Users/Wildfirestore" target="_blank">Cardmarket MTG</a>
              </p>
            </div>
          </div>
          <div class="footer-bottom">
            <p>¬© 2025 WildFire Store Roma - Tutti i diritti riservati</p>
            <p>P.IVA 12345678901</p>
          </div>
        </div>
      </footer>
    </div>
  </div>

<script>
  const GOOGLE_SCRIPTS_VINCENTI =
    "https://script.google.com/macros/s/AKfycbwkgPp0eoWDh-xrTVZ2Tnmv4T9JF66JPd52muFtnxDjH5pcPMjYbe5hGGWol5aOmpVg/exec";

  function handleVincentiData(data) {
    const listContainer = document.getElementById("vincenti-list");
    if (!listContainer) return;

    listContainer.innerHTML = "";
    (data || []).sort((a, b) => a.id - b.id);

    (data || []).forEach(mazzo => {
      const li = document.createElement("li");
      li.classList.add("vincenti-item");

      // markup scheda
      li.innerHTML = `
        <span class="deck-name">${mazzo.nome || ""}</span>
        <span class="deck-author">${mazzo.autore || ""}</span>
        <span class="deck-commander">
          ${(mazzo.comandante1 || "")}${mazzo.comandante2 ? " & " + mazzo.comandante2 : ""}
        </span>
        <span class="deck-date">${mazzo.data || ""}</span>
        <span class="deck-players">Partecipanti: ${mazzo.partecipanti || ""}</span>
        <a class="deck-link" href="${mazzo.link || "#"}" target="_blank">Vedi Mazzo</a>
        ${mazzo.year_season && mazzo.year_season !== "N/A" ? `<span class="deck-season">${mazzo.year_season}</span>` : ""}
      `;

      // Parser robusto delle etichette S?/Y? (accetta "S3/Y1", "Y1/S3", spazi, minuscole, ecc.)
      const tag = String(mazzo.year_season || "").toUpperCase();
      const sMatch = tag.match(/S\s*(\d+)/);
      const yMatch = tag.match(/Y\s*(\d+)/);
      if (sMatch) li.dataset.s = `S${sMatch[1]}`;
      if (yMatch) li.dataset.y = `Y${yMatch[1]}`;

      listContainer.appendChild(li);
    });

    // gestisci centratura se la sezione √® corta
    const section = document.querySelector("section");
    if (section) {
      const sectionHeight = section.offsetHeight;
      const windowHeight = window.innerHeight;
      if (sectionHeight > windowHeight - 160) section.classList.remove("centered-full");
      else section.classList.add("centered-full");
    }

    populateFilters();
    applyFilters(); // applica l'eventuale selezione corrente
  }

  // --- FILTRI DINAMICI ---
  function populateFilters() {
    const sSet = new Set(), ySet = new Set();
    document.querySelectorAll(".vincenti-item").forEach(li => {
      if (li.dataset.s) sSet.add(li.dataset.s);
      if (li.dataset.y) ySet.add(li.dataset.y);
    });

    fillSelect("filter-s", sSet);
    fillSelect("filter-y", ySet);
  }

  function fillSelect(id, valuesSet) {
    const select = document.getElementById(id);
    if (!select) return;

    const current = select.value || "tutte";
    const values = Array.from(valuesSet).sort((a, b) => {
      // Ordina S1 < S2 < S3‚Ä¶ / Y1 < Y2‚Ä¶
      const na = parseInt(a.replace(/[^\d]/g, "")) || 0;
      const nb = parseInt(b.replace(/[^\d]/g, "")) || 0;
      if (a[0] === b[0]) return na - nb;       // stessa lettera (S o Y)
      return a[0].localeCompare(b[0]);         // S prima di Y, o viceversa
    });

    select.innerHTML =
      '<option value="tutte">Tutte</option>' +
      values.map(v => `<option value="${v}">${v}</option>`).join("");

    // ripristina la scelta se gi√† c'era
    if ([...select.options].some(o => o.value === current)) {
      select.value = current;
    }
  }

  function applyFilters() {
    const y = (document.getElementById("filter-y")?.value || "tutte").toUpperCase();
    const s = (document.getElementById("filter-s")?.value || "tutte").toUpperCase();

    document.querySelectorAll("#vincenti-list .vincenti-item").forEach(li => {
      const okY = (y === "TUTTE") || (li.dataset.y === y);
      const okS = (s === "TUTTE") || (li.dataset.s === s);
      li.style.display = (okY && okS) ? "flex" : "none";
    });
  }

  // cambia filtro ‚Üí aggiorna lista
  document.addEventListener("change", (e) => {
    if (e.target && (e.target.id === "filter-y" || e.target.id === "filter-s")) {
      applyFilters();
    }
  });

  async function caricaMazziVincenti() {
    try {
      const resp = await fetch(GOOGLE_SCRIPTS_VINCENTI);
      const data = await resp.json();
      handleVincentiData(data);
    } catch (e) {
      console.error("Errore nel caricamento:", e);
      document.getElementById("vincenti-list").innerHTML =
        "<li class='vincenti-item'>Errore nel caricamento dei dati.</li>";
    }
  }

  // animazioni + fetch dati
  document.addEventListener("DOMContentLoaded", () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add("visible"); });
    }, { threshold: 0.1 });
    document.querySelectorAll("section").forEach(s => observer.observe(s));

    // assicurati che nel markup del header il logo usi src='./logo.png'
    const logo = document.querySelector(".logo-img");
    if (logo && logo.getAttribute("src") === "logo.png") {
      logo.setAttribute("src", "./logo.png");
    }

    caricaMazziVincenti();
  });
</script>
